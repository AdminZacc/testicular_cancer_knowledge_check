<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Prostate Cancer Knowledge Check</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 2rem;
      max-width: 800px;
      margin: auto;
      background-color: white;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
      border-radius: 8px;
    }
    h1 {
      text-align: center;
      color: #0077cc;
    }
    .question {
      margin-bottom: 1.5rem;
    }
    .question h3 {
      margin-bottom: 0.5rem;
    }
    .options label {
      display: block;
      margin: 0.25rem 0;
      position: relative;
      padding-left: 25px;
    }
    .options label.correct::before {
      content: "\2714";
      color: green;
      position: absolute;
      left: 0;
    }
    .options label.incorrect::before {
      content: "\2716";
      color: red;
      position: absolute;
      left: 0;
    }
    #submit {
      background: #0077cc;
      color: white;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    #submit:hover {
      background: #005fa3;
    }
    .result {
      margin-top: 1rem;
      font-weight: bold;
    }
    #counter {
      margin-bottom: 1.5rem;
      font-weight: bold;
      padding: 1rem;
      background: #e6f2ff;
      border-left: 5px solid #0077cc;
      border-radius: 5px;
      color: #003d66;
    }
    #visitorCount {
      font-size: 0.9rem;
      color: #666;
      text-align: center;
      margin-bottom: 1rem;
    }
    #leaderboard {
      margin-top: 2rem;
      padding: 1rem;
      background: #f9f9f9;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    #leaderboard h3 {
      margin-bottom: 0.5rem;
    }
  </style>

</head>
<body>
  <h1>Prostate Cancer Knowledge Check</h1>
  <div id="visitorCount"></div>
  <div id="counter">Attempts: 0</div>
  <form id="quizForm">
    <!-- Questions omitted for brevity -->
  </form>
  <div id="result" class="result"></div>
  <div id="leaderboard"></div>

  <script>
    const answers = {
      q1: "c",
      q2: "b",
      q3: "c",
      q4: "a",
      q5: "a",
      q6: "a",
      q7: "c",
      q8: "a",
      q9: "b",
      q10: "b",
    };

    let attempts = parseInt(localStorage.getItem('attempts')) || 0;
    let highScore = parseInt(localStorage.getItem('highScore')) || 0;
    let visits = parseInt(localStorage.getItem('visits')) || 0;
    visits++;
    localStorage.setItem('visits', visits);

    document.getElementById("visitorCount").textContent = `üë• You‚Äôve visited this quiz ${visits} ${visits === 1 ? 'time' : 'times'}.`;

    const updateCounter = () => {
      document.getElementById("counter").textContent = `Attempts: ${attempts} | High Score: ${highScore}`;
    };

    updateCounter();

    async function submitHighScore(name, score) {
      const { error } = await supabaseClient
        .from('quiz_scores')
        .insert([{ name, score }]);
      if (error) console.error('Error saving high score:', error.message);
      else loadLeaderboard();
    }

    async function loadLeaderboard() {
      const { data, error } = await supabaseClient
        .from('quiz_scores')
        .select('*')
        .order('score', { ascending: false })
        .limit(5);

      if (data) {
        const board = document.getElementById('leaderboard');
        board.innerHTML = '<h3>üèÜ Leaderboard</h3><ol>' +
          data.map(d => `<li>${d.name} - ${d.score}</li>`).join('') +
          '</ol>';
      } else if (error) {
        console.error('Failed to load leaderboard:', error.message);
      }
    }

    loadLeaderboard();

    document.getElementById("submit").addEventListener("click", () => {
      let score = 0;
      let total = Object.keys(answers).length;

      document.querySelectorAll('.options label').forEach(label => {
        label.classList.remove('correct', 'incorrect');
      });

      for (let key in answers) {
        const correctAnswer = answers[key];
        const selected = document.querySelector(`input[name=${key}]:checked`);
        const labels = document.querySelectorAll(`input[name=${key}]`);

        labels.forEach(input => {
          const label = input.closest('label');
          if (input.value === correctAnswer) {
            label.classList.add('correct');
          } else if (selected && input.checked && input.value !== correctAnswer) {
            label.classList.add('incorrect');
          }
        });

        if (selected && selected.value === correctAnswer) {
          score++;
        }
      }

      attempts++;
      localStorage.setItem('attempts', attempts);
      if (score > highScore) {
        highScore = score;
        localStorage.setItem('highScore', highScore);
        const userName = prompt('üéâ New High Score! Enter your name:');
        if (userName) {
          submitHighScore(userName, score);
        }
      }

      document.getElementById("result").textContent = `You got ${score} out of ${total} correct.`;
      updateCounter();
    });
  </script>
</body>
</html>
